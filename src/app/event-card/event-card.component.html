<div class="full-page">
  <div *ngIf="!isDialog() && !fromMap">
    <button
      mat-raised-button
      color="primary"
      (click)="addTask()"
      *ngIf="isDispatcher()"
    >
      הוספת נסיעה
    </button>
    <app-dots-menu [buttons]="buttons" *ngIf="isDispatcher()"></app-dots-menu>
    <data-area [settings]="area"></data-area>
    <div
      *ngIf="tasks.length"
      style="
        display: flex;
        justify-content: space-between;
        flex-direction: row-reverse;
      "
    >
      <button
        mat-raised-button
        color="primary"
        (click)="sortByDistance()"
        *ngIf="!showSortOptions"
      >
        <mat-icon>location_on</mat-icon>קרוב אלי
      </button>
      <mat-form-field
        *ngIf="showSortOptions"
        appearance="outline"
        class="dense-form-field"
        style="margin-bottom: -8px"
      >
        <mat-label>הצג לפי</mat-label>
        <div>
          <select
            matNativeControl
            [(ngModel)]="currentSort"
            (change)="currentSort.selected()"
          >
            <option *ngFor="let v of sortOptions" [ngValue]="v">
              {{ v.caption }}
            </option>
          </select>
        </div>
      </mat-form-field>
      <div style="align-self: center">
        <button
          *ngIf="!showMap"
          mat-raised-button
          (click)="toggleShowMap(true)"
          color="primary"
        >
          <mat-icon>map</mat-icon> מפה
        </button>
        <button
          *ngIf="showMap"
          mat-raised-button
          color="primary"
          (click)="toggleShowMap(false)"
        >
          חזרה לרשימה
        </button>
      </div>
    </div>
    <mat-divider></mat-divider>
  </div>
  <div *ngIf="isDialog()">
    {{ title }}
  </div>
  <div *ngIf="showMap" class="grow-item" style="position: relative">
    <app-noam-test [tasks]="tasksForMap"></app-noam-test>
  </div>
  <div *ngIf="!showMap" [class.grow-item]="!fromMap">
    <div *ngFor="let d of urgencies">
      <ng-container *ngIf="hasEvents(d)">
        <strong *ngIf="urgencies.length > 1">{{ d.urgency }}:</strong>
        <div class="events-container" [transition-group]="'flip-list'">
          <ng-container *ngFor="let e of d.events; trackBy: trackBy">
            <mat-card
              transition-group-item
              class="event-card"
              [class.registered]="isRegisteredToEvent(e) && showingAllTasks"
              *ngIf="filter(e)"
            >
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  margin-bottom: 5px;
                "
              >
                <strong (click)="eventDetails(e)">
                  {{ e.title }}
                </strong>
                <a (click)="eventDetails(e)" *ngIf="!isFull(e) && fromMap">{{
                  'לפרטים'
                }}</a>
                <app-dots-menu
                  [item]="e"
                  [buttons]="menuOptions"
                  *ngIf="isDispatcher() && !fromMap"
                ></app-dots-menu>
              </div>
              <div class="event-info" (click)="eventDetails(e)">
                <app-trip-subtitle
                  style="width: 100%"
                  [onTheWayBack]="onTheWayBack(e)"
                  [distance]="distance(e)"
                  [e]="e"
                  [showDetailsLink]="!isFull(e) && !fromMap"
                ></app-trip-subtitle>
              </div>
            </mat-card>
          </ng-container>
        </div>
      </ng-container>
    </div>
  </div>
</div>
