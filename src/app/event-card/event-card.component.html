<div class="full-page">
  <div *ngIf="!isDialog() && !fromMap">
    <button
      mat-raised-button
      color="primary"
      (click)="addTask()"
      *ngIf="isDispatcher()"
    >
      הוספת נסיעה
    </button>
    <app-dots-menu [buttons]="buttons" *ngIf="isDispatcher()"></app-dots-menu>
    <data-area [settings]="area"></data-area>
    <div
      style="
        display: flex;
        justify-content: space-between;
        flex-direction: row-reverse;
      "
      *ngIf="!showMap"
    >
      <button
        mat-raised-button
        color="primary"
        (click)="sortByDistance()"
        *ngIf="showLocation"
      >
        {{
          !volunteerLocation
            ? 'למעבר לתצוגה לפי מרחק'
            : 'למעבר לתצוגה לפי תאריך'
        }}
      </button>
      <button mat-raised-button (click)="toggleShowMap(true)">מפה</button>
    </div>
    <mat-divider></mat-divider>
  </div>
  <div *ngIf="isDialog()">
    {{ title }}
  </div>
  <div *ngIf="showMap" class="grow-item" style="position: relative">
    <app-noam-test [tasks]="filteredTasks"></app-noam-test>
    <button
      mat-raised-button
      style="position: absolute; left: 10px; top: 10px"
      (click)="toggleShowMap(false)"
    >
      חזרה לרשימה
    </button>
  </div>
  <div *ngIf="!showMap" [class.grow-item]="!fromMap">
    <div *ngFor="let d of urgencies">
      <ng-container *ngIf="hasEvents(d)">
        <strong *ngIf="urgencies.length > 1">{{ d.urgency }}:</strong>
        <div class="events-container" [transition-group]="'flip-list'">
          <ng-container *ngFor="let e of d.events; trackBy: trackBy">
            <mat-card
              transition-group-item
              class="event-card"
              [class.registered]="isRegisteredToEvent(e) && showingAllTasks"
              *ngIf="filter(e)"
            >
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  margin-bottom: 5px;
                "
              >
                <strong (click)="eventDetails(e)">
                  {{ e.title }}
                </strong>
                <a (click)="eventDetails(e)" *ngIf="!isFull(e) && fromMap">{{
                  'לפרטים והרשמה'
                }}</a>
                <app-dots-menu
                  [item]="e"
                  [buttons]="menuOptions"
                  *ngIf="isDispatcher() && !fromMap"
                ></app-dots-menu>
              </div>
              <div class="event-info" (click)="eventDetails(e)">
                <div class="event-detail">
                  <span style="margin-bottom: 10px">
                    <span *ngIf="onTheWayBack(e)" style="font-weight: bold"
                      >בדרך חזרה,
                    </span>
                    {{ e.category || '' }}{{ distance(e) }}
                  </span>

                  <div class="route-start-finish">
                    <div class="route-indicator-container">
                      <div
                        class="row"
                        style="padding-left: 10px; padding-right: 10px"
                      >
                        <div class="dot right"></div>
                        <div class="line"></div>
                        <div class="arrow-container">
                          <div class="arrow"></div>
                          <div
                            class="distance-text"
                            *ngIf="e.toAddressApiResult"
                          >
                            {{ travelDistance(e) }}
                          </div>
                        </div>
                        <div class="dot left"></div>
                      </div>
                      <div class="row" style="padding-top: 5px">
                        <div class="text">{{ eventCity(e) }}</div>
                        <div class="text">
                          <span *ngIf="e.toAddressApiResult">
                            {{ eventToCity(e) }}</span
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- <span>
                    {{ eventCity(e) }}
                    <span *ngIf="e.toAddressApiResult">
                      => {{ eventToCity(e) }} ({{ travelDistance(e) }})</span
                    >
                  </span> -->
                  <div style="margin-bottom: 10px">
                    <strong>{{ displayDate(e) }}</strong>
                  </div>
                  <div class="bottom-container">
                    <a *ngIf="!isFull(e) && !fromMap">{{ 'לפרטים והרשמה' }}</a>
                    <div class="id-text">{{ e.externalId }}#</div>
                  </div>
                  <strong *ngIf="isFull(e)">
                    {{ e.taskStatus.caption }}
                    <span *ngIf="e.driver">, {{ e.driver.name }}</span>
                  </strong>
                </div>
              </div>
            </mat-card>
          </ng-container>
        </div>
      </ng-container>
    </div>
  </div>
</div>
